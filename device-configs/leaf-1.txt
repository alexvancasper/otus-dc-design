set groups To-Spines interfaces <ge-*> mtu 9216
set apply-groups To-Spines
set system root-authentication encrypted-password "$6$sly6GBMT$OzNsBRHi.5Gt.e7OF052epu0KRMFkucTpM1xpZMFeLw4DHJ6kZZSN4WXPYp0v.QQWY/z11Rxq81CImo91rnWb0"
set system host-name leaf-1
set chassis fpc 0 pic 0 tunnel-services bandwidth 1g
set interfaces ge-0/0/0 unit 0 family inet address 10.0.1.1/30
set interfaces ge-0/0/1 unit 0 family inet address 10.0.1.5/30
set interfaces ge-0/0/2 vlan-tagging
set interfaces ge-0/0/2 encapsulation flexible-ethernet-services
set interfaces ge-0/0/2 unit 0 encapsulation vlan-bridge
set interfaces ge-0/0/2 unit 0 vlan-id 10
set interfaces lo0 unit 0 family inet address 10.255.254.1/32 primary
set interfaces lo0 unit 0 family inet address 10.255.254.1/32 preferred
set policy-options policy-statement BGP_LOOPBACK0 term TERM1 from protocol direct
set policy-options policy-statement BGP_LOOPBACK0 term TERM1 from route-filter 0.0.0.0/0 prefix-length-range /32-/32
set policy-options policy-statement BGP_LOOPBACK0 term TERM1 then accept
set policy-options policy-statement PFE-ECMP then load-balance per-packet
set routing-instances EVPN_10 vtep-source-interface lo0.0
set routing-instances EVPN_10 instance-type evpn
set routing-instances EVPN_10 vlan-id 10
set routing-instances EVPN_10 interface ge-0/0/2.0
set routing-instances EVPN_10 vxlan vni 10010
set routing-instances EVPN_10 route-distinguisher 10.255.254.1:1
set routing-instances EVPN_10 vrf-target target:1234:1
set routing-instances EVPN_10 protocols evpn encapsulation vxlan
set routing-options router-id 10.255.254.1
set routing-options forwarding-table export PFE-ECMP
set routing-options autonomous-system 4210000001
set protocols bgp hold-time 10
set protocols bgp group UNDERLAY type external
set protocols bgp group UNDERLAY advertise-peer-as
set protocols bgp group UNDERLAY family inet unicast
set protocols bgp group UNDERLAY export BGP_LOOPBACK0
set protocols bgp group UNDERLAY peer-as 65501
set protocols bgp group UNDERLAY local-as 65511
set protocols bgp group UNDERLAY multipath multiple-as
set protocols bgp group UNDERLAY as-override
set protocols bgp group UNDERLAY neighbor 10.0.1.2
set protocols bgp group UNDERLAY neighbor 10.0.1.6
set protocols bgp group OVERLAY type internal
set protocols bgp group OVERLAY local-address 10.255.254.1
set protocols bgp group OVERLAY family evpn signaling
set protocols bgp group OVERLAY neighbor 10.255.255.1
set protocols bgp group OVERLAY neighbor 10.255.255.2
